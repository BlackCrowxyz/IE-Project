<!doctype html>
<html lang="en" dir="rtl">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Bootstrap CSS -->
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <!-- <link rel="stylesheet" href="css/bootstrap.min.css"> -->
  <link rel="stylesheet" href="css/login.css">
  <link rel="stylesheet" href="css/global.css">
  <!-- w3school CSS icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- google CSS icon -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <title>ثبت‌نام</title>
</head>

<body class="bg-color" onload="setup()">
  <div class="container text-dark p-5">
    <div class="text-center">
      <button class="btn btn-dark m-1" onclick="window.location.href = 'index.html'; setJsonObj('currentUser', null)" type="button" name="button">خروج از حساب کاربری</button>
      <button class="btn btn-primary m-1" onclick="window.location.href = 'report.html'" type="button" name="button">یک گزارش بنویسید</button>
    </div>
    <p class="text-center font-weight-bold h3 py-4">
      گزارشهای ارسالی از طرف دانشجویان
    </p>
    <div id="report-list">
      <report-content v-for="post in posts" :post="post"></report-content>
    </div>
    <!-- ************************************************************* -->
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- <script src="js/jquery-3.3.1.js"></script> -->
    <!-- Optional JavaScript -->
    <script src="js/app.js"></script>
    <!-- Vuejs -->
    <script src="js/vue.js"></script>
    <!-- moment.js -->
    <script src="js/moment.js"></script>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!-- <script src="js/jquery.slim.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script> -->
</body>
<script>
  var reportsObj = getJsonObj("reports")
  // Define a new component called report-content
  Vue.component('report-content', {
    data() {
      return {
        showOrNot: false,
        options: [{
            value: 'in Queue'
          },
          {
            value: 'closed'
          },
          {
            value: 'postponed'
          },
          {
            value: 'open'
          },
        ],
        // selected: '',
        newResponsible: '',
        newStatus: '',
        newDetail: '',
      }
    },
    methods:{
      reportChecked(){
        for (var i = 0; i < reportsObj.reports.length; i++) {
          //finding the equal object to update the data of the 'reports' in localstorage
          if (reportsObj.reports[i] == this.post) {
            this.post.responsible = (this.newResponsible == "") ? this.post.responsible : this.newResponsible
            this.post.status = (this.newStatus == "") ? this.post.status : this.newStatus
            this.post.newDetail = this.newDetail
            //adding and removing (updating) at the same time
            reportsObj.reports.splice(i, 1,this.post)
            setJsonObj("reports",reportsObj)
            this.showOrNot = !this.showOrNot;
          }
        }
      }
    },
    props: ['post'],
    template: `<div class="row shadow1 w-sm-100 m-3">
      <div class="col-12 bg-white text-right">
        <p class="font-weight-bold h5 pt-4 pb-2">
          {{post.title}}
        </p>
        <p class="text-secondary">
          توسط
          {{post.email}}
          در تاریخ
          {{post.date}}
        </p>

        <div class="mt-3 text-secondary">
          مسؤل: {{post.responsible}}
        </div>
        <br />
        <span class="border border-secondary text-secondary rounded p-1">
        وضعیت: {{post.status}}
        </span>
        <hr>
        <p class="">
          {{post.detail}}
        </p>
        <div class="text-center m-3">
          <button class="btn btn-secondary" v-on:click="showOrNot = !showOrNot" type="button" name="button">اقدام/ تغییر مسؤل</button>
        </div>
      </div>
      <div v-show="showOrNot" class="col-12 text-center border border-info p-3">
        <div class="row">
          <span class="col-sm-4 col-lg-2 text-left m-1 pl-2">
            ارجاع به مسؤل دیگر:
          </span>
          <input v-model="newResponsible" class="col-sm-6 col-lg-3 form-control" type="text" id="report-responsible" placeholder="آقا/خانم ...">
        </div>
        <div class="row pt-2">
          <span class="col-sm-4 col-lg-2 text-left m-1 pl-2">
            وضعیت پیگیری:
          </span>
          <select v-model="newStatus" class="custom-select w-sm-50 w-md-50 w-lg-25">
          <option value="" disabled>
            وضعیت را تعیین کنید
          </option>
          <option v-for="option in options" :value="option.value">
            {{option.value}}
          </option>
          </select>
        </div>
        <div class="text-right py-1 pt-4">
          درباره‌ی موضوع مطرح شده توضیحات خود را بنویسید
        </div>
        <textarea v-model="newDetail" class="form-control" rows="3" id="report-detail" placeholder="جزیئات کار را اینجا بنویسید" required></textarea>
        <br>
        <button @click="reportChecked()" class="btn btn-success mt-1" type="button" name="button">تأیید</button></button>
        <button class="btn btn-danger mt-1" @click="showOrNot = !showOrNot" type="button" name="button">رد اقدام</button>
      </div>
    </div>`,
  })

  var vm = new Vue({
    el: '#report-list',
    data: {
      posts: [],
    },
    created() {
      var vm = this //this Vue instance
      for (var i = 0; i < reportsObj['reports'].length; i++) {
        let object = reportsObj['reports'][i]
        vm.posts.push(object)
      }
    },
  })
</script>

</html>
